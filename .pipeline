
pipeline {
    agent { docker { image "hubblestack/cent7dev" } }

    options {
        timestamps()
        ansiColor 'xterm'
    }

    environment {
        PY_COLORS = 1
    }

    stages {
        stage('setup') {
            steps {
                sh 'git clean -dfx; echo clean up repo completely'
                //sh 'rm -vf *-manifest.txt *-result.txt *-output.txt; echo cleaned up output files'
                sh './tests/jenkins-setup.sh'
            }
        }
        stage('parallel') {
            parallel {
                //stage('pylint') { steps { sh './tests/pylint-runner.sh' } }
                stage('pytest') { steps { sh './tests/pytest-runner.sh' } }
                //stage('bandit') { steps { sh './tests/bandit-runner.sh' } }
            }
        }
    }

    post {
        always {
            archiveArtifacts artifacts: 'pylint-*.txt'
            archiveArtifacts artifacts: 'pytest-*.txt'
            archiveArtifacts artifacts: 'bandit-*.txt'
        }
    }
}
